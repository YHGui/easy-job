# 数据仓库

## 概念

星型模型: 星型架构是一种非正规化的结构,多维数据集的每一个维度都直接与事实表相连接,不存在渐变维度

星型模型的核心是一个大的中心表(事实表),一组小的附属表(维表)

1. 事实表就是你要关注的内容
2. 维度表就是你观察该事务的角度,是从哪个角度去观察内容的.注意维度表一定是可穷举的有尽集合

- 优点:不需要外部的连接,查询效率更高
- 缺点: 数据有一定的冗余.

雪花模型:当有一个或多个维表没有直接连接到事实表上,而是通过其他维表连接到事实表上时,其图解就像多个雪花连接在一起,故称雪花模型.

- 优点:通过最大限度地减少数据存储量以及联合较小的维表来改善查询性能,去除了数据冗余
- 缺点:需要多层关联,查询效率低

数据库三范式:

1. 1NF:字段不可再分,原子性
2. 2NF:满足第二范式必须满足第一范式.一个表只能说明一个事物.非主键属性必须完全依赖于主键属性
3. 3NF:满足第三范式必须满足第二范式.每列都与主键有直接关系,不存在传递依赖.任何非主属性不依赖于其它非主属性

## 维度

### 概念

主键:自然键和代理键

自然键:由现实世界已经存在的属性组成的键,具有业务含义

代理键:不具有业务含义的键,用于处理缓慢变化维

### 维度整合

1. 命名规范的统一,表名,字段名等统一;
2. 字段类型的统一,相同和相似字段的字段类型统一;
3. 公共代码及代码值的统一,公共代码及标志性字段的数据类型,命名方式等统一;
4. 业务含义相同的表的统一,主要依据高内聚,低耦合的理念,在物理实现中,将业务关系大,源系统影响差异小的表进行整合,将业务关系小,源系统影响差异大的表分而治之,集成方式
   1. 主从表设计方式,公有字段(主要基本信息)放主表中,从属信息分别放在各自的从表中
   2. 直接合并,共有信息和个性信息放在同一表中
   3. 不合并

如何处理缓慢变化维?

1. 快照方式:每天保留一份全量快照数据:
   1. 优点:简单有效,开发和维护成本低;使用方便,理解性好.
   2. 缺点:存储浪费
2. 历史拉链存储:新增link_end_date和link_begin_date
   1. 优点:以天为粒度反应所有数据变更;存储减小
   2. 缺点:理解使用有一定难度
3. 极限存储:
   1. 透明化:底层拉链,上层做一个视图操作或者在Hive里做一个hook
   2. 分月做历史拉链表
4. 微型维度:极限存储时如果某些维度每天都变化,可以将变化频繁维度从主维度抽出